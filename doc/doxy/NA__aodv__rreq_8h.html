<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>NETWORK ATTACKS FRAMEWORK: NA_aodv_rreq.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">NETWORK ATTACKS FRAMEWORK
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A NETwork Attacks framework. Making network attacks impact evaluation easier!</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('NA__aodv__rreq_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">NA_aodv_rreq.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="NA__defs__aodv_8h_source.html">NA_defs_aodv.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="NA__seek__list_8h_source.html">NA_seek_list.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="NA__routing__table_8h_source.html">NA_routing_table.h</a>&quot;</code><br/>
<code>#include &lt;endian.h&gt;</code><br/>
</div>
<p><a href="NA__aodv__rreq_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structRREQ.html">RREQ</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrreq__record.html">rreq_record</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structblacklist.html">blacklist</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#ac9cb17ec604388c8aa7a9272f8b75fea">RREQ_JOIN</a>&#160;&#160;&#160;0x1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#ae073f0655f6e5023366e73341603bf76">RREQ_REPAIR</a>&#160;&#160;&#160;0x2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a064b5e5007e297023c926e9c08a83fe6">RREQ_GRATUITOUS</a>&#160;&#160;&#160;0x4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a3f51f9640f82443e5b0df1c4c19a57d7">RREQ_DEST_ONLY</a>&#160;&#160;&#160;0x8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>&#160;&#160;&#160;sizeof(<a class="el" href="structRREQ.html">RREQ</a>)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRREQ.html">RREQ</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a91404e3227d5da2703e28c94a2ebb80c">rreq_create</a> (u_int8_t flags, struct in_addr dest_addr, u_int32_t dest_seqno, struct in_addr orig_addr)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Route Request process hacked.  <a href="#a91404e3227d5da2703e28c94a2ebb80c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a97bfe3209cdc72356521354c5c8c14da">rreq_send</a> (struct in_addr dest_addr, u_int32_t dest_seqno, int ttl, u_int8_t flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a04c174a4a6ee340f5c46056912f150ae">rreq_forward</a> (<a class="el" href="structRREQ.html">RREQ</a> *rreq, int size, int ttl)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#afe0300126a2381817c2eb233e27793be">rreq_process</a> (<a class="el" href="structRREQ.html">RREQ</a> *rreq, int rreqlen, struct in_addr ip_src, struct in_addr ip_dst, int ip_ttl, unsigned int ifindex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a9ca9c8b1462c06a7b9d4d1e5fba844bd">rreq_route_discovery</a> (struct in_addr dest_addr, u_int8_t flags, struct <a class="el" href="structip__data.html">ip_data</a> *ipd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#adeccae18fbed4e70f9bbe461d2b86493">rreq_record_timeout</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structblacklist.html">blacklist</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#ab169d3400e13a25e71cbc711edbc3479">rreq_blacklist_insert</a> (struct in_addr dest_addr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#ae5bce6fa66090b205e58c033355308d8">rreq_blacklist_timeout</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#a4f8377877f7465bf09d86a1856abf4dc">rreq_local_repair</a> (<a class="el" href="NA__routing__table_8h.html#acaa7d17e5a6c4e70d3885eecf75ab299">rt_table_t</a> *rt, struct in_addr src_addr, struct <a class="el" href="structip__data.html">ip_data</a> *ipd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NA__aodv__rreq_8h.html#ade150745c2d8367b4c6a6dd84c2782e2">rreq_proactive</a> (void *arg)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a3f51f9640f82443e5b0df1c4c19a57d7"></a><!-- doxytag: member="NA_aodv_rreq.h::RREQ_DEST_ONLY" ref="a3f51f9640f82443e5b0df1c4c19a57d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="NA__aodv__rreq_8h.html#a3f51f9640f82443e5b0df1c4c19a57d7">RREQ_DEST_ONLY</a>&#160;&#160;&#160;0x8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8h_source.html#l00046">46</a> of file <a class="el" href="NA__aodv__rreq_8h_source.html">NA_aodv_rreq.h</a>.</p>

</div>
</div>
<a class="anchor" id="a064b5e5007e297023c926e9c08a83fe6"></a><!-- doxytag: member="NA_aodv_rreq.h::RREQ_GRATUITOUS" ref="a064b5e5007e297023c926e9c08a83fe6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="NA__aodv__rreq_8h.html#a064b5e5007e297023c926e9c08a83fe6">RREQ_GRATUITOUS</a>&#160;&#160;&#160;0x4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8h_source.html#l00045">45</a> of file <a class="el" href="NA__aodv__rreq_8h_source.html">NA_aodv_rreq.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac9cb17ec604388c8aa7a9272f8b75fea"></a><!-- doxytag: member="NA_aodv_rreq.h::RREQ_JOIN" ref="ac9cb17ec604388c8aa7a9272f8b75fea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="NA__aodv__rreq_8h.html#ac9cb17ec604388c8aa7a9272f8b75fea">RREQ_JOIN</a>&#160;&#160;&#160;0x1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8h_source.html#l00043">43</a> of file <a class="el" href="NA__aodv__rreq_8h_source.html">NA_aodv_rreq.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae073f0655f6e5023366e73341603bf76"></a><!-- doxytag: member="NA_aodv_rreq.h::RREQ_REPAIR" ref="ae073f0655f6e5023366e73341603bf76" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="NA__aodv__rreq_8h.html#ae073f0655f6e5023366e73341603bf76">RREQ_REPAIR</a>&#160;&#160;&#160;0x2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8h_source.html#l00044">44</a> of file <a class="el" href="NA__aodv__rreq_8h_source.html">NA_aodv_rreq.h</a>.</p>

</div>
</div>
<a class="anchor" id="aeb57a50b78532df8cdc85169924c3a34"></a><!-- doxytag: member="NA_aodv_rreq.h::RREQ_SIZE" ref="aeb57a50b78532df8cdc85169924c3a34" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="NA__aodv__msg__struct_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>&#160;&#160;&#160;sizeof(<a class="el" href="structRREQ.html">RREQ</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8h_source.html#l00076">76</a> of file <a class="el" href="NA__aodv__rreq_8h_source.html">NA_aodv_rreq.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab169d3400e13a25e71cbc711edbc3479"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_blacklist_insert" ref="ab169d3400e13a25e71cbc711edbc3479" args="(struct in_addr dest_addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structblacklist.html">blacklist</a>* <a class="el" href="NA__aodv__rreq_8h.html#ab169d3400e13a25e71cbc711edbc3479">rreq_blacklist_insert</a> </td>
          <td>(</td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>dest_addr</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l01146">1146</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <span class="keyword">struct </span><a class="code" href="structblacklist.html">blacklist</a> *bl;

    <span class="comment">/* First check if this rreq packet is already buffered */</span>
    bl = <a class="code" href="NA__aodv__rreq_8cc.html#ac6eb4bb639eec6b703a79830727bd08b">rreq_blacklist_find</a>(<a class="code" href="structblacklist.html#a4cd374398ee0d0887e64bec9686e1384">dest_addr</a>);

    <span class="comment">/* If already buffered, should we update the timer??? */</span>
    <span class="keywordflow">if</span> (bl)
        <span class="keywordflow">return</span> bl;

    <span class="keywordflow">if</span> ((bl = (<span class="keyword">struct</span> <a class="code" href="structblacklist.html">blacklist</a> *) malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structblacklist.html">blacklist</a>))) == NULL)
    {
        fprintf(stderr, <span class="stringliteral">&quot;Malloc failed!!!\n&quot;</span>);
        exit(-1);
    }
    bl-&gt;<a class="code" href="structblacklist.html#a4cd374398ee0d0887e64bec9686e1384">dest_addr</a>.s_addr = <a class="code" href="structblacklist.html#a4cd374398ee0d0887e64bec9686e1384">dest_addr</a>.s_addr;

    <a class="code" href="NA__timer__queue__aodv_8cc.html#a721feeb3bf29621e58f8914c0d5365c0">timer_init</a>(&amp;bl-&gt;<a class="code" href="structblacklist.html#af3bd75cfef0228bfc50a4a3f69bc501e">bl_timer</a>, &amp;<a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__rreq_8cc.html#a7af5884405c2ec2f3c53faff51b9764b">rreq_blacklist_timeout</a>, bl);
    rreq_blacklist.insert(std::make_pair(<a class="code" href="structblacklist.html#a4cd374398ee0d0887e64bec9686e1384">dest_addr</a>.s_addr,bl));

    <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;bl-&gt;<a class="code" href="structblacklist.html#af3bd75cfef0228bfc50a4a3f69bc501e">bl_timer</a>, <a class="code" href="NA__params_8h.html#a3a66879fa66e9450dbf0d7eff2f07153">BLACKLIST_TIMEOUT</a>);
    <span class="keywordflow">return</span> bl;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae5bce6fa66090b205e58c033355308d8"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_blacklist_timeout" ref="ae5bce6fa66090b205e58c033355308d8" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#ae5bce6fa66090b205e58c033355308d8">rreq_blacklist_timeout</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l01181">1181</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span><a class="code" href="structblacklist.html">blacklist</a> *bl = (<span class="keyword">struct </span><a class="code" href="structblacklist.html">blacklist</a> *)arg;
    <span class="keywordflow">for</span> (RreqBlacklist::iterator it = rreq_blacklist.begin();it!=rreq_blacklist.end();it++)
    {
        <span class="keyword">struct </span><a class="code" href="structblacklist.html">blacklist</a> *blAux = it-&gt;second;
        <span class="keywordflow">if</span> (bl == blAux)
        {
            rreq_blacklist.erase(it);

        }
    }
    free(bl);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a91404e3227d5da2703e28c94a2ebb80c"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_create" ref="a91404e3227d5da2703e28c94a2ebb80c" args="(u_int8_t flags, struct in_addr dest_addr, u_int32_t dest_seqno, struct in_addr orig_addr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRREQ.html">RREQ</a>* <a class="el" href="NA__aodv__rreq_8h.html#a91404e3227d5da2703e28c94a2ebb80c">rreq_create</a> </td>
          <td>(</td>
          <td class="paramtype">u_int8_t&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>dest_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>dest_seqno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>orig_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Route Request process hacked. </p>
<p>This class implement the code modifications for the specific implemented attacks. Each modification has a specific label (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classNA__AODVUU.html" title="ADOVUU hacked module.">NA_AODVUU</a>)</dd></dl>
<p>Attacks implemented </p>
<table  border="1">
<tr>
<th>Attack </th><th>Label </th><th>Implementation notes   </th></tr>
<tr>
<td>Sinkhole </td><td>NA_SINKHOLE </td><td>Modified methods: <a class="el" href="NA__aodv__rreq_8cc.html#affac4a5837bdf5c895943d9f68920b02">rreq_process()</a>  </td></tr>
</table>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classNA__AODVUU.html" title="ADOVUU hacked module.">NA_AODVUU</a></dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Leovigildo SÃ¡nchez Casado, <a href="mailto:sancale@ugr.es">sancale@ugr.es</a> </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>01/22/2013 </dd></dl>

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00112">112</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structRREQ.html">RREQ</a> *rreq;
<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>    rreq = (<a class="code" href="structRREQ.html">RREQ</a> *) <a class="code" href="NA__aodv__socket_8h.html#a14f13b555897ccb9d3619b2e5d1c8af8">aodv_socket_new_msg</a>();
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    rreq = <span class="keyword">new</span> <a class="code" href="structRREQ.html">RREQ</a>();
    rreq-&gt;<a class="code" href="structRREQ.html#a018dc9fa534100d0443f1a4f1f758d70">cost</a>=0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    rreq-&gt;<a class="code" href="structRREQ.html#a26e0b5cc9afb38009889c817607c164e">type</a> = <a class="code" href="NA__defs__aodv_8h.html#a367cd375e15ce9ae860d778bd08ad2d6">AODV_RREQ</a>;
    rreq-&gt;<a class="code" href="structRREQ.html#aa079d52c60fed3fbdd7bfed6778aa08d">res1</a> = 0;
    rreq-&gt;<a class="code" href="structRREQ.html#aba7947bbc4dbea9e0077a1dee79d7a7e">res2</a> = 0;
    rreq-&gt;<a class="code" href="structRREQ.html#a15e476654f78faa03aa4b28a7cce425e">hcnt</a> = 0;
    rreq-&gt;<a class="code" href="structRREQ.html#a4f469136e4af95cd40adbc8f55d4da0e">rreq_id</a> = <a class="code" href="NA__aodv__uu__omnet_8h.html#ae4027a6ad07f13aa12eab285a1b46019">htonl</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#ad7cd479f367ded9d8884f1f8c8dd5f02">rreq_id</a>++);
    rreq-&gt;<a class="code" href="structRREQ.html#a45d9523cee3586f9529f7a8035a3639e">dest_addr</a> = <a class="code" href="structblacklist.html#a4cd374398ee0d0887e64bec9686e1384">dest_addr</a>.s_addr;
    rreq-&gt;<a class="code" href="structRREQ.html#a2d62c2f3ca9adda8eb8397cf20e38cf9">dest_seqno</a> = <a class="code" href="NA__aodv__uu__omnet_8h.html#ae4027a6ad07f13aa12eab285a1b46019">htonl</a>(dest_seqno);
    rreq-&gt;<a class="code" href="structRREQ.html#ad00af2a4f3ef82f3abb5ca546f061ae0">orig_addr</a> = orig_addr.s_addr;

    <span class="comment">/* Immediately before a node originates a RREQ flood it must</span>
<span class="comment">       increment its sequence number... */</span>
    <a class="code" href="NA__routing__table_8h.html#adcbbc879166f0c959ee99af816bfa2ce">seqno_incr</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>);
    rreq-&gt;<a class="code" href="structRREQ.html#a59153e98953882b638634a517d6ed08b">orig_seqno</a> = <a class="code" href="NA__aodv__uu__omnet_8h.html#ae4027a6ad07f13aa12eab285a1b46019">htonl</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>);

    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="NA__aodv__rreq_8h.html#ac9cb17ec604388c8aa7a9272f8b75fea">RREQ_JOIN</a>)
        rreq-&gt;<a class="code" href="structRREQ.html#ab93400f5a066176fbd03a4a3c1f96827">j</a> = 1;
    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="NA__aodv__rreq_8h.html#ae073f0655f6e5023366e73341603bf76">RREQ_REPAIR</a>)
        rreq-&gt;<a class="code" href="structRREQ.html#ab86a51ad9143ee065774620e732bf14d">r</a> = 1;
    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="NA__aodv__rreq_8h.html#a064b5e5007e297023c926e9c08a83fe6">RREQ_GRATUITOUS</a>)
        rreq-&gt;<a class="code" href="structRREQ.html#abfe4a1fbdd22fb97ad70543f35d12d57">g</a> = 1;
    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="NA__aodv__rreq_8h.html#a3f51f9640f82443e5b0df1c4c19a57d7">RREQ_DEST_ONLY</a>)
        rreq-&gt;<a class="code" href="structRREQ.html#a597864126a8d5faeb1e9c500675a2b99">d</a> = 1;

    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Assembled RREQ %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(<a class="code" href="structblacklist.html#a4cd374398ee0d0887e64bec9686e1384">dest_addr</a>));
<span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
<span class="preprocessor"></span>    <a class="code" href="NA__debug__aodv_8cc.html#a6f298772c189a00cc31d8c4998d6e0ec">log_pkt_fields</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">return</span> rreq;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a04c174a4a6ee340f5c46056912f150ae"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_forward" ref="a04c174a4a6ee340f5c46056912f150ae" args="(RREQ *rreq, int size, int ttl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#a04c174a4a6ee340f5c46056912f150ae">rreq_forward</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRREQ.html">RREQ</a> *&#160;</td>
          <td class="paramname"><em>rreq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00208">208</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>in_addr dest, orig;
    <span class="keywordtype">int</span> i;

    dest.s_addr = ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>));
    orig.s_addr = rreq-&gt;<a class="code" href="structRREQ.html#ad00af2a4f3ef82f3abb5ca546f061ae0">orig_addr</a>;

    <span class="comment">/* FORWARD the RREQ if the TTL allows it. */</span>
    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_INFO, 0, <span class="stringliteral">&quot;forwarding RREQ src=%s, rreq_id=%lu&quot;</span>,
          <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(orig), <a class="code" href="NA__aodv__uu__omnet_8h.html#ac317b3e903719ba02894f1710f7f2439">ntohl</a>(rreq-&gt;<a class="code" href="structRREQ.html#a4f469136e4af95cd40adbc8f55d4da0e">rreq_id</a>));

    <span class="comment">/* Queue the received message in the send buffer */</span>
<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>    rreq = (<a class="code" href="structRREQ.html">RREQ</a> *) <a class="code" href="NA__aodv__socket_8h.html#a0addab2c6796c6d480d71b776f2b491b">aodv_socket_queue_msg</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq, size);
    rreq-&gt;<a class="code" href="structRREQ.html#a15e476654f78faa03aa4b28a7cce425e">hcnt</a>++;       <span class="comment">/* Increase hopcount to account for</span>
<span class="comment">                 * intermediate route */</span>

    <span class="comment">/* Send out on all interfaces */</span>
    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="NA__defs__aodv_8h.html#a995d79de9a32d682e10323e736e94505">MAX_NR_INTERFACES</a>; i++)
    {
        <span class="keywordflow">if</span> (!<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).enabled)
            <span class="keywordflow">continue</span>;
        <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq, dest, size, ttl, &amp;<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i));
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    rreq-&gt;hcnt++;       <span class="comment">/* Increase hopcount to account for</span>
<span class="comment">                 * intermediate route */</span>
    <span class="keywordflow">if</span> (this-&gt;isStaticNode())
        rreq-&gt;hopfix++;
    <span class="comment">/* Send out on all interfaces */</span>
    <span class="keywordtype">double</span> delay = -1;
    <span class="keywordflow">if</span> (par(<span class="stringliteral">&quot;EqualDelay&quot;</span>))
        delay = par(<span class="stringliteral">&quot;broadcastDelay&quot;</span>);

    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="NA__defs__aodv_8h.html#a995d79de9a32d682e10323e736e94505">MAX_NR_INTERFACES</a>; i++)
    {
        <span class="keywordflow">if</span> (!<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).enabled)
            <span class="keywordflow">continue</span>;
        totalRreqSend++;
        <a class="code" href="structRREQ.html">RREQ</a> * rreq_new = check_and_cast &lt;<a class="code" href="structRREQ.html">RREQ</a>*&gt;(rreq-&gt;<a class="code" href="structAODV__msg.html#a703e90ebd3dc169fd9863f95df9d5181">dup</a>());
        rreq_new-&gt;<a class="code" href="structAODV__msg.html#a14556cf0f421518fc2e073d4ba23ca25">ttl</a>=ttl;
        <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq_new, dest, size, ttl, &amp;<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i),delay);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4f8377877f7465bf09d86a1856abf4dc"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_local_repair" ref="a4f8377877f7465bf09d86a1856abf4dc" args="(rt_table_t *rt, struct in_addr src_addr, struct ip_data *ipd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#a4f8377877f7465bf09d86a1856abf4dc">rreq_local_repair</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="NA__routing__table_8h.html#acaa7d17e5a6c4e70d3885eecf75ab299">rt_table_t</a> *&#160;</td>
          <td class="paramname"><em>rt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>src_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__data.html">ip_data</a> *&#160;</td>
          <td class="paramname"><em>ipd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00897">897</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>timeval now;
    <a class="code" href="structseek__list.html">seek_list_t</a> *seek_entry;
    <a class="code" href="structrt__table.html">rt_table_t</a> *src_entry;
    <span class="keywordtype">int</span> ttl;
    u_int8_t flags = 0;

    <span class="keywordflow">if</span> (!rt)
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (<a class="code" href="NA__seek__list_8cc.html#ae26827bd74face659624808c4d7bd517">seek_list_find</a>(rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>))
        <span class="keywordflow">return</span>;

    <span class="keywordflow">if</span> (!(rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> &amp; <a class="code" href="NA__routing__table_8h.html#a9be54cbcb590c1da1bae887e4fa48152">RT_REPAIR</a>))
        <span class="keywordflow">return</span>;

    gettimeofday(&amp;now, NULL);

    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;REPAIRING route to %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>));

    <span class="comment">/* Caclulate the initial ttl to use for the RREQ. MIN_REPAIR_TTL</span>
<span class="comment">       mentioned in the draft is the last known hop count to the</span>
<span class="comment">       destination. */</span>

    src_entry = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(src_addr);

    <span class="keywordflow">if</span> (src_entry)
        ttl = <a class="code" href="NA__defs__aodv_8h.html#a24e753bacac6be5f30e18f8a2bdefda4">max</a>((<span class="keywordtype">int</span>)rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>, (<span class="keywordtype">int</span>)(0.5 * src_entry-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>)) + <a class="code" href="NA__params_8h.html#abc3599e0c9eaf33e57d7937bcd684a9b">LOCAL_ADD_TTL</a>;
    <span class="keywordflow">else</span>
        ttl = rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a> + <a class="code" href="NA__params_8h.html#abc3599e0c9eaf33e57d7937bcd684a9b">LOCAL_ADD_TTL</a>;

    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;%s, rreq ttl=%d, dest_hcnt=%d&quot;</span>,
          <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>), ttl, rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>);

    <span class="comment">/* Reset the timeout handler, was probably previously</span>
<span class="comment">       local_repair_timeout */</span>
    rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>.<a class="code" href="structtimer.html#a8d72cd7c39f6285ef3833c7d6b236176">handler</a> = &amp;<a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__timeout_8cc.html#a34ff12101d7e56bc8aa8df4df6f5a75a">route_expire_timeout</a>;

<span class="preprocessor">#ifdef AODV_USE_STL</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ((rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>.<a class="code" href="structtimer.html#af63926c1d0b05f7fe6af1280c7bde571">timeout</a> -simTime()) &lt; (2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>))
        <a class="code" href="NA__routing__table_8cc.html#a26317d59b04b99645fb385905635422c">rt_table_update_timeout</a>(rt, 2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (timeval_diff(&amp;rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>.<a class="code" href="structtimer.html#af63926c1d0b05f7fe6af1280c7bde571">timeout</a>, &amp;now) &lt; (2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>))
        <a class="code" href="NA__routing__table_8cc.html#a26317d59b04b99645fb385905635422c">rt_table_update_timeout</a>(rt, 2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <a class="code" href="NA__aodv__rreq_8cc.html#a0f18767bd3b3d0523627df16ab9f6841">rreq_send</a>(rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>, rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a>, ttl, flags);

    <span class="comment">/* Remember that we are seeking this destination and setup the</span>
<span class="comment">       timers */</span>
    seek_entry = <a class="code" href="NA__seek__list_8cc.html#a31894ce935804c62ba48cd0519311f0c">seek_list_insert</a>(rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>, rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a>,
                                  ttl, flags, ipd);

    <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a>)
        <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;seek_entry-&gt;seek_timer,
                          2 * ttl * <a class="code" href="NA__params_8h.html#a0909f76b1a726623f317de10db30f87f">NODE_TRAVERSAL_TIME</a>);
    <span class="keywordflow">else</span>
        <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;seek_entry-&gt;seek_timer, <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>);

    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Seeking %s ttl=%d&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>), ttl);

    <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade150745c2d8367b4c6a6dd84c2782e2"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_proactive" ref="ade150745c2d8367b4c6a6dd84c2782e2" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#ade150745c2d8367b4c6a6dd84c2782e2">rreq_proactive</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00964">964</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>in_addr dest;
    <span class="keywordflow">if</span> (!isRoot)
         <span class="keywordflow">return</span>;
    <span class="keywordflow">if</span> (this-&gt;isInMacLayer())
         dest.s_addr= ManetAddress(MACAddress::BROADCAST_ADDRESS);
    <span class="keywordflow">else</span>
         dest.s_addr= ManetAddress(IPv4Address::ALLONES_ADDRESS);
    <a class="code" href="NA__aodv__rreq_8cc.html#a0f18767bd3b3d0523627df16ab9f6841">rreq_send</a>(dest,0,<a class="code" href="NA__params_8h.html#ad3c6dedc50547453ac88519fe1fd5d59">NET_DIAMETER</a>, <a class="code" href="NA__aodv__rreq_8h.html#a3f51f9640f82443e5b0df1c4c19a57d7">RREQ_DEST_ONLY</a>);
    <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;proactive_rreq_timer, proactive_rreq_timeout);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe0300126a2381817c2eb233e27793be"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_process" ref="afe0300126a2381817c2eb233e27793be" args="(RREQ *rreq, int rreqlen, struct in_addr ip_src, struct in_addr ip_dst, int ip_ttl, unsigned int ifindex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#afe0300126a2381817c2eb233e27793be">rreq_process</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRREQ.html">RREQ</a> *&#160;</td>
          <td class="paramname"><em>rreq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rreqlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>ip_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>ip_dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ip_ttl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>ifindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00254">254</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{

    <a class="code" href="structAODV__ext.html">AODV_ext</a> *ext=NULL;
    <a class="code" href="structRREP.html">RREP</a> *rrep = NULL;
    <span class="keywordtype">int</span> rrep_size = <a class="code" href="NA__aodv__rrep_8h.html#ac669983cc9abc78e4c80825bcde6fa49">RREP_SIZE</a>;
    <a class="code" href="structrt__table.html">rt_table_t</a> *rev_rt=NULL, *fwd_rt = NULL;
    u_int32_t rreq_orig_seqno, rreq_dest_seqno;
    u_int32_t rreq_id, rreq_new_hcnt, life;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> extlen = 0;
    <span class="keyword">struct </span>in_addr rreq_dest, rreq_orig;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ifaddr;
    uint32_t cost;
    uint8_t  hopfix;

    <span class="comment">// BEGIN NA_SINKHOLE - sancale</span>
    <span class="comment">// Seqno sinkhole definition</span>
    u_int32_t seqno_sinkhole;
    <span class="comment">// END NA_SINKHOLE - sancale</span>

    ManetAddress aux;
    <span class="keywordflow">if</span> (getAp(rreq-&gt;<a class="code" href="structRREQ.html#a45d9523cee3586f9529f7a8035a3639e">dest_addr</a>, aux) &amp;&amp; !isBroadcast(rreq-&gt;<a class="code" href="structRREQ.html#a45d9523cee3586f9529f7a8035a3639e">dest_addr</a>))
    {
        rreq_dest.s_addr = aux;
    }
    <span class="keywordflow">else</span>
        rreq_dest.s_addr = rreq-&gt;<a class="code" href="structRREQ.html#a45d9523cee3586f9529f7a8035a3639e">dest_addr</a>;

    <span class="keywordflow">if</span> (getAp(rreq-&gt;<a class="code" href="structRREQ.html#ad00af2a4f3ef82f3abb5ca546f061ae0">orig_addr</a>, aux))
    {
        rreq_orig.s_addr = aux;
    }
    <span class="keywordflow">else</span>
        rreq_orig.s_addr = rreq-&gt;<a class="code" href="structRREQ.html#ad00af2a4f3ef82f3abb5ca546f061ae0">orig_addr</a>;
    rreq_id = <a class="code" href="NA__aodv__uu__omnet_8h.html#ac317b3e903719ba02894f1710f7f2439">ntohl</a>(rreq-&gt;<a class="code" href="structRREQ.html#a4f469136e4af95cd40adbc8f55d4da0e">rreq_id</a>);
    rreq_dest_seqno = <a class="code" href="NA__aodv__uu__omnet_8h.html#ac317b3e903719ba02894f1710f7f2439">ntohl</a>(rreq-&gt;<a class="code" href="structRREQ.html#a2d62c2f3ca9adda8eb8397cf20e38cf9">dest_seqno</a>);
    rreq_orig_seqno = <a class="code" href="NA__aodv__uu__omnet_8h.html#ac317b3e903719ba02894f1710f7f2439">ntohl</a>(rreq-&gt;<a class="code" href="structRREQ.html#a59153e98953882b638634a517d6ed08b">orig_seqno</a>);
    rreq_new_hcnt = rreq-&gt;<a class="code" href="structRREQ.html#a15e476654f78faa03aa4b28a7cce425e">hcnt</a> + 1;
    cost = rreq-&gt;<a class="code" href="structRREQ.html#a018dc9fa534100d0443f1a4f1f758d70">cost</a>;
    hopfix = rreq-&gt;<a class="code" href="structRREQ.html#ac8c1d4503244e3f7c0f5bc3f3045a90c">hopfix</a>;
    <span class="keywordflow">if</span> (this-&gt;isStaticNode())
        hopfix++;



    <span class="comment">/* Ignore RREQ&#39;s that originated from this node. Either we do this</span>
<span class="comment">       or we buffer our own sent RREQ&#39;s as we do with others we</span>
<span class="comment">       receive. */</span>
    ifaddr = <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(ifindex).ipaddr.s_addr.getIPv4().getInt();
<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (rreq_orig.s_addr == <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(ifindex).ipaddr.s_addr)
        <span class="keywordflow">return</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (isLocalAddress (rreq_orig.s_addr))
        <span class="keywordflow">return</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;ip_src=%s rreq_orig=%s rreq_dest=%s\n&quot;</span>,
          <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(ip_src), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_orig), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_dest));
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>
    totalRreqRec++;
    <span class="keywordflow">if</span> (!ev.isDisabled())
        ev.printf(<span class="stringliteral">&quot;ip_src=%s rreq_orig=%s rreq_dest=%s\n&quot;</span>,<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(ip_src),
                  <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_orig), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_dest));


    <span class="comment">// BEGIN NA_SINKHOLE - sancale</span>
    <span class="comment">// If sinkhole does not know the route, update seqno to seqno_sinkhole and hop_count to 1.</span>
    <span class="keywordflow">if</span> (sinkholeAttackIsActive) {
        <span class="keywordflow">if</span> ((sinkOnlyWhenRouteInTable == <span class="keyword">false</span>) and (uniform(0, 1) &lt; sinkholeAttackProbability)) {
            u_int32_t seqno_added = seqnoAdded-&gt;doubleValue();
            <span class="keywordtype">int</span> num_hops = numHops;
            seqno_sinkhole = rreq_dest_seqno + seqno_added;
            EV &lt;&lt; <span class="stringliteral">&quot;Sinkhole does not know the route but sends false RREP with seqnoAdded = &quot;</span> &lt;&lt; seqno_added &lt;&lt; <span class="stringliteral">&quot; and numHops = &quot;</span> &lt;&lt; num_hops &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;
            <span class="comment">//IPv4Address node_address = IPvXAddressResolver().resolve(&quot;attacker&quot;).get4();</span>
            <span class="comment">//EV &lt;&lt; simTime() &lt;&lt; &quot;s: &quot; &lt;&lt; rreq-&gt;getName() &lt;&lt; &quot; received in &quot; &lt;&lt; node_address &lt;&lt; &quot; (&quot; &lt;&lt; getParentModule()-&gt;getFullName() &lt;&lt; &quot;) originated from &quot; &lt;&lt; ip_to_str(rreq_orig) &lt;&lt; &quot;\n&quot;;</span>

            <span class="comment">/* The node always creates or updates a REVERSE ROUTE entry to the source of the RREQ. */</span>
            rev_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(rreq_orig);
            <span class="comment">/* Calculate the extended minimal life time. */</span>
            life = <a class="code" href="NA__params_8h.html#abeb57a4eb9ac9a56ff59a58aa7e5052a">PATH_DISCOVERY_TIME</a> - 2 * rreq_new_hcnt * <a class="code" href="NA__params_8h.html#a0909f76b1a726623f317de10db30f87f">NODE_TRAVERSAL_TIME</a>;
            <span class="keywordflow">if</span> (rev_rt == NULL) {
                <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Creating REVERSE route entry, RREQ orig: %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_orig));
                rev_rt = <a class="code" href="NA__routing__table_8cc.html#aa2ab023febf342ee9ac01a344ebd4e50">rt_table_insert</a>(rreq_orig, ip_src, rreq_new_hcnt, rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, 0, ifindex,cost,hopfix);
            } <span class="keywordflow">else</span> {
                <span class="keywordflow">if</span> (!useHover &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> == 0 || (int32_t) rreq_orig_seqno &gt; (int32_t) rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> ||
                        (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> || rreq_new_hcnt &lt; rev_rt-&gt;hcnt)))) {
                    rev_rt = <a class="code" href="NA__routing__table_8cc.html#a30f5595aef61223fe39fa39ebe85126e">rt_table_update</a>(rev_rt, ip_src, rreq_new_hcnt, rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a>,ifindex,cost,hopfix);
                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (useHover &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> == 0 || (int32_t) rreq_orig_seqno &gt; (int32_t) rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> ||
                            (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> || cost &lt; rev_rt-&gt;cost)))) {
                    rev_rt = <a class="code" href="NA__routing__table_8cc.html#a30f5595aef61223fe39fa39ebe85126e">rt_table_update</a>(rev_rt, ip_src, rreq_new_hcnt, rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a>,ifindex,cost,hopfix);
                }
            }
            <span class="comment">/**** END updating/creating REVERSE route ****/</span>

            <span class="comment">/* Set the destination IP address in RREP (dest_addr) to the IP address of the destination for which a route is supplied (rreq_dest in RREQ).</span>
<span class="comment">             * Set the originator IP address in RREP (orig_addr) to the IP address of the node which originated the RREQ for which the route is supplied (rreq_orig in RREQ).</span>
<span class="comment">             */</span>
            rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, num_hops, rreq_dest, seqno_sinkhole, rreq_orig, <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>);
            <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, NULL, <a class="code" href="NA__aodv__rrep_8h.html#ac669983cc9abc78e4c80825bcde6fa49">RREP_SIZE</a>);
            <span class="keywordflow">return</span>;
        }
    }
    <span class="comment">// END NA_SINKHOLE - sancale</span>

<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">if</span> (rreqlen &lt; (<span class="keywordtype">int</span>) <a class="code" href="NA__aodv__rreq_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>)
    {
        <a class="code" href="NA__debug__aodv_8cc.html#abcaff98caa7648ba8c38888a45cda786">alog</a>(LOG_WARNING, 0,
             __FUNCTION__, <span class="stringliteral">&quot;IP data field too short (%u bytes)&quot;</span>
             <span class="stringliteral">&quot;from %s to %s&quot;</span>, rreqlen, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(ip_src), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(ip_dst));
        <span class="keywordflow">return</span>;
    }

    <span class="comment">/* Check if the previous hop of the RREQ is in the blacklist set. If</span>
<span class="comment">       it is, then ignore the RREQ. */</span>
    <span class="keywordflow">if</span> (<a class="code" href="NA__aodv__rreq_8cc.html#ac6eb4bb639eec6b703a79830727bd08b">rreq_blacklist_find</a>(ip_src))
    {
        <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;prev hop of RREQ blacklisted, ignoring!&quot;</span>);
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>        EV &lt;&lt; <span class="stringliteral">&quot;prev hop of RREQ blacklisted, ignoring!&quot;</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordflow">return</span>;
    }

    <span class="comment">/* Ignore already processed RREQs. */</span>
    <span class="keywordflow">if</span> (<a class="code" href="NA__aodv__rreq_8cc.html#affd06aea84d2e0e37e03fcc85df6dd55">rreq_record_find</a>(rreq_orig, rreq_id))
    {
        life = <a class="code" href="NA__params_8h.html#abeb57a4eb9ac9a56ff59a58aa7e5052a">PATH_DISCOVERY_TIME</a> - 2 * rreq_new_hcnt * <a class="code" href="NA__params_8h.html#a0909f76b1a726623f317de10db30f87f">NODE_TRAVERSAL_TIME</a>;
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (isBroadcast(rreq_dest.s_addr))
        {
           rev_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(rreq_orig);
           <span class="keywordflow">if</span> (rev_rt == NULL)
           {
               rev_rt = <a class="code" href="NA__routing__table_8cc.html#aa2ab023febf342ee9ac01a344ebd4e50">rt_table_insert</a>(rreq_orig, ip_src, rreq_new_hcnt, rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, 0, ifindex,cost,hopfix);
               <span class="comment">// opp_error(&quot;reverse route NULL with RREQ in the processed table&quot; );</span>
           }
           <span class="keywordflow">if</span> (rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> != 0)
           {
               <span class="keywordflow">if</span> ((int32_t) rreq_orig_seqno &lt; (int32_t) rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a>)
                   <span class="keywordflow">return</span>;
               <span class="keywordflow">if</span> (!useHover &amp;&amp; (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp;
                   (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> != <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> &amp;&amp; rreq_new_hcnt &gt;= rev_rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>)))
                   <span class="keywordflow">return</span>;
               <span class="keywordflow">if</span> (useHover &amp;&amp; (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp;
                   (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> != <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> &amp;&amp; cost &gt;= rev_rt-&gt;<a class="code" href="structrt__table.html#a92c3eda19beb2f0bebd7d0829c817f7b">cost</a>)))
                   <span class="keywordflow">return</span>;
           }
        }
        <span class="keywordflow">else</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        {
            rev_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(rreq_orig);
            <span class="keywordflow">if</span> (rev_rt == NULL)
            {
                 rev_rt = <a class="code" href="NA__routing__table_8cc.html#aa2ab023febf342ee9ac01a344ebd4e50">rt_table_insert</a>(rreq_orig, ip_src, rreq_new_hcnt,rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, 0, ifindex,cost,hopfix);
                 <span class="comment">// opp_error(&quot;reverse route NULL with RREQ in the processed table&quot; );</span>
            }
            <span class="keywordflow">if</span> (useHover &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> == 0 ||
                    (int32_t) rreq_orig_seqno &gt; (int32_t) rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> ||
                    (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp;
                     (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> || cost &lt; rev_rt-&gt;cost))))
            {
                life = <a class="code" href="NA__params_8h.html#abeb57a4eb9ac9a56ff59a58aa7e5052a">PATH_DISCOVERY_TIME</a> - 2 * rreq_new_hcnt * <a class="code" href="NA__params_8h.html#a0909f76b1a726623f317de10db30f87f">NODE_TRAVERSAL_TIME</a>;
                rev_rt = <a class="code" href="NA__routing__table_8cc.html#a30f5595aef61223fe39fa39ebe85126e">rt_table_update</a>(rev_rt, ip_src, rreq_new_hcnt,
                                         rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>,
                                         rev_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a>,ifindex,cost,hopfix);
            }
            <span class="keywordflow">return</span>;
        }
    }

    <span class="comment">/* Now buffer this RREQ so that we don&#39;t process a similar RREQ we</span>
<span class="comment">       get within PATH_DISCOVERY_TIME. */</span>
    <a class="code" href="NA__aodv__rreq_8cc.html#af4878520b917fa6798c595d007b3f39e">rreq_record_insert</a>(rreq_orig, rreq_id);

    <span class="comment">/* Determine whether there are any RREQ extensions */</span>


<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>    ext = (<a class="code" href="structAODV__ext.html">AODV_ext</a> *) ((<span class="keywordtype">char</span> *) rreq + <a class="code" href="NA__aodv__rreq_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>);
    <span class="keywordflow">while</span> ((rreqlen - extlen) &gt; <a class="code" href="NA__aodv__rreq_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>)
    {
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    ext = rreq-&gt;<a class="code" href="structAODV__msg.html#a15798e963b9232abdd01f5a473ee9964">getFirstExtension</a>();
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;rreq-&gt;<a class="code" href="structAODV__msg.html#a6c9686ee9e579621b17c9d055d49f710">getNumExtension</a> (); i++)
    {
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordflow">switch</span> (ext-&gt;<a class="code" href="structAODV__ext.html#ab3bafc740f1e875463664be1fab80048">type</a>)
        {
        <span class="keywordflow">case</span> <a class="code" href="NA__defs__aodv_8h.html#a93c9663a0af495b6c586df39bd0617d1">RREQ_EXT</a>:
            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_INFO, 0, <span class="stringliteral">&quot;RREQ include EXTENSION&quot;</span>);
            <span class="comment">/* Do something here */</span>
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <a class="code" href="NA__debug__aodv_8cc.html#abcaff98caa7648ba8c38888a45cda786">alog</a>(LOG_WARNING, 0, __FUNCTION__, <span class="stringliteral">&quot;Unknown extension type %d&quot;</span>,
                 ext-&gt;<a class="code" href="structAODV__ext.html#ab3bafc740f1e875463664be1fab80048">type</a>);
            <span class="keywordflow">break</span>;
        }
        extlen += <a class="code" href="NA__defs__aodv_8h.html#a57782cde4653abb3167322895528f740">AODV_EXT_SIZE</a>(ext);
        ext = <a class="code" href="NA__defs__aodv_8h.html#a3913180ebbd49bc1c73650e233746d59">AODV_EXT_NEXT</a>(ext);
    }
<span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
<span class="preprocessor"></span>    <a class="code" href="NA__debug__aodv_8cc.html#a6f298772c189a00cc31d8c4998d6e0ec">log_pkt_fields</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">/* The node always creates or updates a REVERSE ROUTE entry to the</span>
<span class="comment">       source of the RREQ. */</span>
    rev_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(rreq_orig);

    <span class="comment">/* Calculate the extended minimal life time. */</span>
    life = <a class="code" href="NA__params_8h.html#abeb57a4eb9ac9a56ff59a58aa7e5052a">PATH_DISCOVERY_TIME</a> - 2 * rreq_new_hcnt * <a class="code" href="NA__params_8h.html#a0909f76b1a726623f317de10db30f87f">NODE_TRAVERSAL_TIME</a>;

    <span class="keywordflow">if</span> (rev_rt == NULL)
    {
        <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Creating REVERSE route entry, RREQ orig: %s&quot;</span>,
              <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_orig));

        rev_rt = <a class="code" href="NA__routing__table_8cc.html#aa2ab023febf342ee9ac01a344ebd4e50">rt_table_insert</a>(rreq_orig, ip_src, rreq_new_hcnt,
                                 rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, 0, ifindex,cost,hopfix);
    }
    <span class="keywordflow">else</span>
    {
        <span class="keywordflow">if</span> (!useHover &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> == 0 ||
                (int32_t) rreq_orig_seqno &gt; (int32_t) rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> ||
                (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp;
                 (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> || rreq_new_hcnt &lt; rev_rt-&gt;hcnt))))
        {
            rev_rt = <a class="code" href="NA__routing__table_8cc.html#a30f5595aef61223fe39fa39ebe85126e">rt_table_update</a>(rev_rt, ip_src, rreq_new_hcnt,
                                     rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>,
                                     rev_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a>,ifindex,cost,hopfix);
        }


        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (useHover &amp;&amp; (rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> == 0 ||
                (int32_t) rreq_orig_seqno &gt; (int32_t) rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> ||
                (rreq_orig_seqno == rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a> &amp;&amp;
                 (rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> || cost &lt; rev_rt-&gt;cost))))
        {
            rev_rt = <a class="code" href="NA__routing__table_8cc.html#a30f5595aef61223fe39fa39ebe85126e">rt_table_update</a>(rev_rt, ip_src, rreq_new_hcnt,
                                     rreq_orig_seqno, life, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>,
                                     rev_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a>,ifindex,cost,hopfix);
        }

<span class="preprocessor">#ifdef DISABLED</span>
<span class="preprocessor"></span>        <span class="comment">/* This is a out of draft modification of AODV-UU to prevent</span>
<span class="comment">           nodes from creating routing entries to themselves during</span>
<span class="comment">           the RREP phase. We simple drop the RREQ if there is a</span>
<span class="comment">           missmatch between the reverse path on the node and the one</span>
<span class="comment">           suggested by the RREQ. */</span>

        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rev_rt-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr != ip_src.s_addr)
        {
            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Dropping RREQ due to reverse route mismatch!&quot;</span>);
            <span class="keywordflow">return</span>;
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }
    <span class="comment">/**** END updating/creating REVERSE route ****/</span>

<span class="preprocessor">#ifdef CONFIG_GATEWAY</span>
<span class="preprocessor"></span>    <span class="comment">/* This is a gateway */</span>
    <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a6be52079b3b26f9986ccdddfbca964e6">internet_gw_mode</a>)
    {
        <span class="comment">/* Subnet locality decision */</span>
        <span class="keywordflow">switch</span> (<a class="code" href="NA__locality_8cc.html#ade45344f5396241a476b05ad274b0740">locality</a>(rreq_dest, ifindex))
        {
        <span class="keywordflow">case</span> <a class="code" href="NA__locality_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba022de955aadff3994c951d42f16da5d4">HOST_ADHOC</a>:
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="NA__locality_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba47bd58179abc7b79c42aa79cf7fd2fa2">HOST_INET</a>:
            <span class="comment">/* We must increase the gw&#39;s sequence number before sending a RREP,</span>
<span class="comment">             * otherwise intermediate nodes will not forward the RREP. */</span>
            <a class="code" href="NA__routing__table_8h.html#adcbbc879166f0c959ee99af816bfa2ce">seqno_incr</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>);
            rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, 0, <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>).ipaddr,
                               <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                               <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>);

            ext = <a class="code" href="NA__aodv__rrep_8cc.html#ac197ec74c90027caaa7b54f0d7f22475">rrep_add_ext</a>(rrep, <a class="code" href="NA__defs__aodv_8h.html#a96b0b4df1abc1caecc489265e5032363">RREP_INET_DEST_EXT</a>, rrep_size,
                               <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in_addr), (<span class="keywordtype">char</span> *) &amp;rreq_dest);

            rrep_size += <a class="code" href="NA__defs__aodv_8h.html#a57782cde4653abb3167322895528f740">AODV_EXT_SIZE</a>(ext);

            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0,
                  <span class="stringliteral">&quot;Responding for INTERNET dest: %s rrep_size=%d&quot;</span>,
                  <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_dest), rrep_size);

            <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, NULL, rrep_size);

            <span class="keywordflow">return</span>;

        <span class="keywordflow">case</span> <a class="code" href="NA__locality_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba0cb4b9eff0a3c338d559ad509412a068">HOST_UNKNOWN</a>:
        <span class="keywordflow">default</span>:
            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;GW: Destination unkown&quot;</span>);
        }
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (getIsGateway())
    {
        <span class="comment">/* Subnet locality decision */</span>
        <span class="comment">// search address</span>
        <span class="keywordflow">if</span> (isAddressInProxyList(rreq_dest.s_addr))
        {
            <span class="comment">/* We must increase the gw&#39;s sequence number before sending a RREP,</span>
<span class="comment">             * otherwise intermediate nodes will not forward the RREP. */</span>
            <a class="code" href="NA__routing__table_8h.html#adcbbc879166f0c959ee99af816bfa2ce">seqno_incr</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>);
            rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, 0, <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>).ipaddr,
                               <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                               <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>);

            ext = <a class="code" href="NA__aodv__rrep_8cc.html#ac197ec74c90027caaa7b54f0d7f22475">rrep_add_ext</a>(rrep, <a class="code" href="NA__defs__aodv_8h.html#a96b0b4df1abc1caecc489265e5032363">RREP_INET_DEST_EXT</a>, rrep_size,
                               <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in_addr), (<span class="keywordtype">char</span> *) &amp;rreq_dest);

            rrep_size += <a class="code" href="NA__defs__aodv_8h.html#a57782cde4653abb3167322895528f740">AODV_EXT_SIZE</a>(ext);


            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0,
                  <span class="stringliteral">&quot;Responding for INTERNET dest: %s rrep_size=%d&quot;</span>,
                  <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_dest), rrep_size);

            <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, NULL, rrep_size);

            <span class="keywordflow">return</span>;

        }
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    <span class="comment">/* Are we the destination of the RREQ?, if so we should immediately send a</span>
<span class="comment">       RREP.. */</span>
<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (rreq_dest.s_addr == <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(ifindex).ipaddr.s_addr)
    {
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (isLocalAddress (rreq_dest.s_addr))
    {
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <span class="comment">/* WE are the RREQ DESTINATION. Update the node&#39;s own</span>
<span class="comment">           sequence number to the maximum of the current seqno and the</span>
<span class="comment">           one in the RREQ. */</span>
        <span class="keywordflow">if</span> (rreq_dest_seqno != 0)
        {
            <span class="keywordflow">if</span> ((int32_t) <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a> &lt; (int32_t) rreq_dest_seqno)
                <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a> = rreq_dest_seqno;
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a> == rreq_dest_seqno)
                <a class="code" href="NA__routing__table_8h.html#adcbbc879166f0c959ee99af816bfa2ce">seqno_incr</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>);
        }
        rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, 0, <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>).ipaddr,
                           <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                           <a class="code" href="NA__params_8h.html#a38dd5bbbfaf801cab8956702dce9fb36">MY_ROUTE_TIMEOUT</a>);
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>        EV &lt;&lt; <span class="stringliteral">&quot; create a rrep&quot;</span> &lt;&lt; <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>).ipaddr) &lt;&lt; <span class="stringliteral">&quot;seq n&quot;</span> &lt;&lt; <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, NULL, <a class="code" href="NA__aodv__rrep_8h.html#ac669983cc9abc78e4c80825bcde6fa49">RREP_SIZE</a>);

    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isBroadcast (rreq_dest.s_addr))
    {
        <span class="keywordflow">if</span>(!rreq-&gt;<a class="code" href="structRREQ.html#a597864126a8d5faeb1e9c500675a2b99">d</a>)
            <span class="keywordflow">return</span>;
        <span class="keywordflow">if</span> (!propagateProactive)
            <span class="keywordflow">return</span>;

        <span class="comment">/* WE are the RREQ DESTINATION. Update the node&#39;s own</span>
<span class="comment">           sequence number to the maximum of the current seqno and the</span>
<span class="comment">           one in the RREQ. */</span>
        <a class="code" href="NA__routing__table_8h.html#adcbbc879166f0c959ee99af816bfa2ce">seqno_incr</a>(<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>);
        rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, 0, <a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>).ipaddr,<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>, <a class="code" href="NA__params_8h.html#a38dd5bbbfaf801cab8956702dce9fb36">MY_ROUTE_TIMEOUT</a>);
        EV &lt;&lt; <span class="stringliteral">&quot; create a rrep&quot;</span> &lt;&lt; <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>).ipaddr) &lt;&lt; <span class="stringliteral">&quot;seq n&quot;</span> &lt;&lt; <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>);
        <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, NULL, <a class="code" href="NA__aodv__rrep_8h.html#ac669983cc9abc78e4c80825bcde6fa49">RREP_SIZE</a>);
        <span class="keywordflow">if</span> (ip_ttl &gt; 0)
        {
            <a class="code" href="NA__aodv__rreq_8cc.html#a10253a843853f1a2db64693939853c5d">rreq_forward</a>(rreq, rreqlen, ip_ttl); <span class="comment">// the ttl is decremented for ip layer</span>
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;RREQ not forwarded - ttl=0&quot;</span>);
            EV &lt;&lt; <span class="stringliteral">&quot;RREQ not forwarded - ttl=0&quot;</span>;
        }
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">/* We are an INTERMEDIATE node. - check if we have an active</span>
<span class="comment">         * route entry */</span>

        fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(rreq_dest);

        <span class="comment">// BEGIN NA_SINKHOLE - sancale</span>
        <span class="comment">// If sinkhole knows the route, update seqno to seqno_sinkhole and hop_count to 1.</span>
        <span class="comment">// If route exist and is valid. We do not care about the &quot;only destination&quot; flag in the RREQ.</span>
        <span class="keywordflow">if</span> (fwd_rt &amp;&amp; (fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)){
            <span class="comment">/* Respond only if the sequence number is fresh enough... */</span>
            <span class="keywordflow">if</span> ((fwd_rt-&gt;dest_seqno != 0 &amp;&amp; (int32_t) fwd_rt-&gt;dest_seqno &gt;= (int32_t) rreq_dest_seqno &amp;&amp;
                    (fwd_rt-&gt;hcnt&gt;<a class="code" href="NA__aodv__rreq_8cc.html#a2c43392bcf4b1b862a9b1734dab30e67">HCNT_LIMIT</a>))|| fwd_rt-&gt;state==<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>) {

                <span class="keywordflow">if</span> (sinkholeAttackIsActive) {
                    <span class="keywordflow">if</span> ((sinkOnlyWhenRouteInTable == <span class="keyword">true</span>) and (uniform(0,1) &lt; sinkholeAttackProbability)) {

                        <span class="keyword">struct </span>timeval now;
                        u_int32_t lifetime;
                        gettimeofday(&amp;now, NULL);

                        <span class="keywordflow">if</span> (fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
                            lifetime = 10000;
                        <span class="keywordflow">else</span> {
<span class="preprocessor">#ifdef AODV_USE_STL</span>
<span class="preprocessor"></span>                            <span class="keywordtype">double</span> val = SIMTIME_DBL(fwd_rt-&gt;rt_timer.timeout - simTime());
                            lifetime = (val * 1000.0);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>                            lifetime = timeval_diff(&amp;fwd_rt-&gt;rt_timer.timeout, &amp;now);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                        }
                        u_int32_t seqno_added = seqnoAdded-&gt;doubleValue();
                        <span class="keywordtype">int</span> num_hops = numHops;
                        seqno_sinkhole = rreq_dest_seqno + seqno_added;
                        rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, num_hops, fwd_rt-&gt;dest_addr, seqno_sinkhole, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>, lifetime);
                        <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, fwd_rt, rrep_size);
                        EV &lt;&lt; <span class="stringliteral">&quot;Sinkhole knows the route and sends false RREP with seqnoAdded = &quot;</span> &lt;&lt; seqno_added &lt;&lt; <span class="stringliteral">&quot; and numHops = &quot;</span> &lt;&lt; num_hops &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;
                        <span class="keywordflow">return</span>;
                    }
                }
            }
        }
        <span class="comment">// END NA_SINKHOLE - sancale</span>

        <span class="keywordflow">if</span> (fwd_rt &amp;&amp; (fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>) &amp;&amp; !rreq-&gt;<a class="code" href="structRREQ.html#a597864126a8d5faeb1e9c500675a2b99">d</a>)
        {
            <span class="keyword">struct </span>timeval now;
            u_int32_t lifetime;

            <span class="comment">/* GENERATE RREP, i.e we have an ACTIVE route entry that is fresh</span>
<span class="comment">               enough (our destination sequence number for that route is</span>
<span class="comment">               larger than the one in the RREQ). */</span>

            gettimeofday(&amp;now, NULL);
<span class="preprocessor">#ifdef CONFIG_GATEWAY_DISABLED</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (fwd_rt-&gt;flags &amp; <a class="code" href="NA__routing__table_8h.html#a4f25f14df0966a49e4c012e651688179">RT_INET_DEST</a>)
            {
                <a class="code" href="structrt__table.html">rt_table_t</a> *gw_rt;
                <span class="comment">/* This node knows that this is a rreq for an Internet</span>
<span class="comment">                 * destination and it has a valid route to the gateway */</span>

                <span class="keywordflow">goto</span> forward;   <span class="comment">// DISABLED</span>

                gw_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(fwd_rt-&gt;next_hop);

                <span class="keywordflow">if</span> (!gw_rt || gw_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a>)
                    <span class="keywordflow">goto</span> forward;

                lifetime = timeval_diff(&amp;gw_rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>.<a class="code" href="structtimer.html#af63926c1d0b05f7fe6af1280c7bde571">timeout</a>, &amp;now);

                rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, gw_rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>, gw_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                                   gw_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                                   lifetime);

                ext = <a class="code" href="NA__aodv__rrep_8cc.html#ac197ec74c90027caaa7b54f0d7f22475">rrep_add_ext</a>(rrep, <a class="code" href="NA__defs__aodv_8h.html#a96b0b4df1abc1caecc489265e5032363">RREP_INET_DEST_EXT</a>, rrep_size,
                                   <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in_addr), (<span class="keywordtype">char</span> *) &amp;rreq_dest);

                rrep_size += <a class="code" href="NA__defs__aodv_8h.html#a57782cde4653abb3167322895528f740">AODV_EXT_SIZE</a>(ext);

                <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0,
                      <span class="stringliteral">&quot;Intermediate node response for INTERNET dest: %s rrep_size=%d&quot;</span>,
                      <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_dest), rrep_size);

                <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, gw_rt, rrep_size);
                <span class="keywordflow">return</span>;
            }
<span class="preprocessor">#endif              </span><span class="comment">/* CONFIG_GATEWAY_DISABLED */</span>

            <span class="comment">/* Respond only if the sequence number is fresh enough... */</span>
<span class="comment">//      if ((fwd_rt-&gt;dest_seqno != 0 &amp;&amp;</span>
<span class="comment">//      (int32_t) fwd_rt-&gt;dest_seqno &gt;= (int32_t) rreq_dest_seqno &amp;&amp;</span>
<span class="comment">//                (fwd_rt-&gt;hcnt&gt;HCNT_LIMIT || (fwd_rt-&gt;hcnt==HCNT_LIMIT &amp;&amp; uniform(0, 1)&gt;0.8 ))) || fwd_rt-&gt;state==IMMORTAL) {</span>
            <span class="keywordflow">if</span> ((fwd_rt-&gt;dest_seqno != 0 &amp;&amp;
                    (int32_t) fwd_rt-&gt;dest_seqno &gt;= (int32_t) rreq_dest_seqno &amp;&amp;
                    (fwd_rt-&gt;hcnt&gt;<a class="code" href="NA__aodv__rreq_8cc.html#a2c43392bcf4b1b862a9b1734dab30e67">HCNT_LIMIT</a>))|| fwd_rt-&gt;state==<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
            {
<span class="comment">//      if (fwd_rt-&gt;dest_seqno != 0 &amp;&amp;</span>
<span class="comment">//      (int32_t) fwd_rt-&gt;dest_seqno &gt;= (int32_t) rreq_dest_seqno) {</span>
<span class="preprocessor">#ifdef AODV_USE_STL</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (fwd_rt-&gt;state==<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
                    lifetime = 10000;
                <span class="keywordflow">else</span>
                {
                    <span class="keywordtype">double</span> val = SIMTIME_DBL(fwd_rt-&gt;rt_timer.timeout - simTime());
                    lifetime = (val * 1000.0);
                }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (fwd_rt-&gt;state==<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
                    lifetime = 10000;
                <span class="keywordflow">else</span>
                    lifetime = timeval_diff(&amp;fwd_rt-&gt;rt_timer.timeout, &amp;now);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, fwd_rt-&gt;hcnt, fwd_rt-&gt;dest_addr,
                                   fwd_rt-&gt;dest_seqno, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                                   lifetime);
                <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, rev_rt, fwd_rt, rrep_size);
                <span class="comment">/* If the GRATUITOUS flag is set, we must also unicast a</span>
<span class="comment">                   gratuitous RREP to the destination. */</span>
                <span class="keywordflow">if</span> (rreq-&gt;<a class="code" href="structRREQ.html#abfe4a1fbdd22fb97ad70543f35d12d57">g</a>)
                {
                    rrep = <a class="code" href="NA__aodv__rrep_8cc.html#a0d97a830d97e4cf9ae1745cc9a6829c3">rrep_create</a>(0, 0, rev_rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>, rev_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,
                                       rev_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a>, fwd_rt-&gt;dest_addr,
                                       lifetime);
                    <a class="code" href="NA__aodv__rrep_8cc.html#abfb72f5b128d4137701e1b6d0e4c79b6">rrep_send</a>(rrep, fwd_rt, rev_rt, <a class="code" href="NA__aodv__rrep_8h.html#ac669983cc9abc78e4c80825bcde6fa49">RREP_SIZE</a>);
                    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_INFO, 0, <span class="stringliteral">&quot;Sending G-RREP to %s with rte to %s&quot;</span>,
                          <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_dest), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(rreq_orig));
                }
                <span class="keywordflow">return</span>;
            }
            <span class="comment">/*</span>
<span class="comment">                        else</span>
<span class="comment">                        {</span>
<span class="comment">                            goto forward;</span>
<span class="comment">                        }</span>
<span class="comment">            //      If the GRATUITOUS flag is set, we must also unicast a</span>
<span class="comment">            //             gratuitous RREP to the destination.</span>
<span class="comment">                        if (rreq-&gt;g)</span>
<span class="comment">                        {</span>
<span class="comment">                            rrep = rrep_create(0, 0, rev_rt-&gt;hcnt, rev_rt-&gt;dest_addr,</span>
<span class="comment">                               rev_rt-&gt;dest_seqno, fwd_rt-&gt;dest_addr,</span>
<span class="comment">                               lifetime);</span>
<span class="comment"></span>
<span class="comment">                            rrep_send(rrep, fwd_rt, rev_rt, RREP_SIZE);</span>
<span class="comment"></span>
<span class="comment">                            DEBUG(LOG_INFO, 0, &quot;Sending G-RREP to %s with rte to %s&quot;,</span>
<span class="comment">                                    ip_to_str(rreq_dest), ip_to_str(rreq_orig));</span>
<span class="comment">                        }</span>
<span class="comment">                        return;</span>
<span class="comment">            */</span>
        }
forward:
<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (ip_ttl &gt; 1)
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (ip_ttl &gt; 0)
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        {
            <span class="comment">/* Update the sequence number in case the maintained one is larger */</span>
            <span class="keywordflow">if</span> (fwd_rt &amp;&amp; (fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;state == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>) &amp;&amp; !rreq-&gt;<a class="code" href="structRREQ.html#a597864126a8d5faeb1e9c500675a2b99">d</a>&amp;&amp; 0!=<a class="code" href="NA__aodv__rreq_8cc.html#a2c43392bcf4b1b862a9b1734dab30e67">HCNT_LIMIT</a>)
            {
                <span class="keywordflow">if</span> (fwd_rt-&gt;dest_seqno != 0 &amp;&amp;
                (int32_t) fwd_rt-&gt;dest_seqno &gt;= (int32_t) rreq_dest_seqno &amp;&amp; fwd_rt-&gt;hcnt==<a class="code" href="NA__aodv__rreq_8cc.html#a2c43392bcf4b1b862a9b1734dab30e67">HCNT_LIMIT</a>)
                    ip_ttl = <a class="code" href="NA__aodv__rreq_8cc.html#a2c43392bcf4b1b862a9b1734dab30e67">HCNT_LIMIT</a>;
            }
            <span class="keywordflow">if</span> (fwd_rt &amp;&amp; !(fwd_rt-&gt;flags &amp; <a class="code" href="NA__routing__table_8h.html#a4f25f14df0966a49e4c012e651688179">RT_INET_DEST</a>) &amp;&amp;
                    (int32_t) fwd_rt-&gt;dest_seqno &gt; (int32_t) rreq_dest_seqno)
                rreq-&gt;<a class="code" href="structRREQ.html#a2d62c2f3ca9adda8eb8397cf20e38cf9">dest_seqno</a> = <a class="code" href="NA__aodv__uu__omnet_8h.html#ae4027a6ad07f13aa12eab285a1b46019">htonl</a>(fwd_rt-&gt;dest_seqno);
<span class="preprocessor">#ifndef OMNETPP</span>
<span class="preprocessor"></span>            <a class="code" href="NA__aodv__rreq_8cc.html#a10253a843853f1a2db64693939853c5d">rreq_forward</a>(rreq, rreqlen, --ip_ttl);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>            <a class="code" href="NA__aodv__rreq_8cc.html#a10253a843853f1a2db64693939853c5d">rreq_forward</a>(rreq, rreqlen, ip_ttl); <span class="comment">// the ttl is decremented for ip layer</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;RREQ not forwarded - ttl=0&quot;</span>);
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>            EV &lt;&lt; <span class="stringliteral">&quot;RREQ not forwarded - ttl=0&quot;</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="adeccae18fbed4e70f9bbe461d2b86493"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_record_timeout" ref="adeccae18fbed4e70f9bbe461d2b86493" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#adeccae18fbed4e70f9bbe461d2b86493">rreq_record_timeout</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l01130">1130</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span><a class="code" href="structrreq__record.html">rreq_record</a> *rec = (<span class="keyword">struct </span><a class="code" href="structrreq__record.html">rreq_record</a> *) arg;
    <span class="keywordflow">for</span> (RreqRecords::iterator it = rreq_records.begin();it!=rreq_records.end();it++)
    {
        <span class="keyword">struct </span><a class="code" href="structrreq__record.html">rreq_record</a> *recAux = *it;
        <span class="keywordflow">if</span> (rec  == recAux)
        {
            rreq_records.erase(it);
            <span class="keywordflow">break</span>;
        }
    }
    free(rec);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9ca9c8b1462c06a7b9d4d1e5fba844bd"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_route_discovery" ref="a9ca9c8b1462c06a7b9d4d1e5fba844bd" args="(struct in_addr dest_addr, u_int8_t flags, struct ip_data *ipd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#a9ca9c8b1462c06a7b9d4d1e5fba844bd">rreq_route_discovery</a> </td>
          <td>(</td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>dest_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int8_t&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__data.html">ip_data</a> *&#160;</td>
          <td class="paramname"><em>ipd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00828">828</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">struct </span>timeval now;
    <a class="code" href="structrt__table.html">rt_table_t</a> *rt;
    <a class="code" href="structseek__list.html">seek_list_t</a> *seek_entry;
    u_int32_t dest_seqno;
    <span class="keywordtype">int</span> ttl;
<span class="preprocessor">#define TTL_VALUE ttl</span>
<span class="preprocessor"></span>
    gettimeofday(&amp;now, NULL);

    <span class="keywordflow">if</span> (<a class="code" href="NA__seek__list_8cc.html#ae26827bd74face659624808c4d7bd517">seek_list_find</a>(dest_addr))
        <span class="keywordflow">return</span>;

    <span class="comment">/* If we already have a route entry, we use information from it. */</span>
    rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);

    ttl = <a class="code" href="NA__params_8h.html#ad3c6dedc50547453ac88519fe1fd5d59">NET_DIAMETER</a>;     <span class="comment">/* This is the TTL if we don&#39;t use expanding</span>
<span class="comment">                   ring search */</span>
    <span class="keywordflow">if</span> (!rt)
    {
        dest_seqno = 0;

        <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a>)
            ttl = <a class="code" href="NA__params_8h.html#a25ab47cb76166dd649dfb39459efa2a8">TTL_START</a>;

    }
    <span class="keywordflow">else</span>
    {
        dest_seqno = rt-&gt;dest_seqno;

        <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a>)
        {
            ttl = rt-&gt;hcnt + <a class="code" href="NA__params_8h.html#a9b98102c6ade66d2319441c85faa5544">TTL_INCREMENT</a>;
        }

        <span class="comment">/*  if (rt-&gt;flags &amp; RT_INET_DEST) */</span>
        <span class="comment">/*      flags |= RREQ_DEST_ONLY; */</span>

        <span class="comment">/* A routing table entry waiting for a RREP should not be expunged</span>
<span class="comment">           before 2 * NET_TRAVERSAL_TIME... */</span>
<span class="preprocessor">#ifdef AODV_USE_STL</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ((rt-&gt;rt_timer.timeout - simTime()) &lt; (2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>))
            <a class="code" href="NA__routing__table_8cc.html#a26317d59b04b99645fb385905635422c">rt_table_update_timeout</a>(rt, 2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (timeval_diff(&amp;rt-&gt;rt_timer.timeout, &amp;now) &lt;
                (2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>))
            <a class="code" href="NA__routing__table_8cc.html#a26317d59b04b99645fb385905635422c">rt_table_update_timeout</a>(rt, 2 * <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }

    <a class="code" href="NA__aodv__rreq_8cc.html#a0f18767bd3b3d0523627df16ab9f6841">rreq_send</a>(dest_addr, dest_seqno, ttl, flags);

    <span class="comment">/* Remember that we are seeking this destination */</span>
    seek_entry = <a class="code" href="NA__seek__list_8cc.html#a31894ce935804c62ba48cd0519311f0c">seek_list_insert</a>(dest_addr, dest_seqno, ttl, flags, ipd);

    <span class="comment">/* Set a timer for this RREQ */</span>
    <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a>)
        <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;seek_entry-&gt;<a class="code" href="structseek__list.html#a00c347cd92eb6640d3a978fba27be08f">seek_timer</a>, <a class="code" href="NA__params_8h.html#a3fa7f5382024b27578b0bc43a5ee5633">RING_TRAVERSAL_TIME</a>);
    <span class="keywordflow">else</span>
        <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;seek_entry-&gt;<a class="code" href="structseek__list.html#a00c347cd92eb6640d3a978fba27be08f">seek_timer</a>, <a class="code" href="NA__params_8h.html#a2b829767acaf5a7deca54a6563d17921">NET_TRAVERSAL_TIME</a>);

    <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Seeking %s ttl=%d&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(dest_addr), ttl);

    <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a97bfe3209cdc72356521354c5c8c14da"></a><!-- doxytag: member="NA_aodv_rreq.h::rreq_send" ref="a97bfe3209cdc72356521354c5c8c14da" args="(struct in_addr dest_addr, u_int32_t dest_seqno, int ttl, u_int8_t flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="NA__aodv__rreq_8h.html#a97bfe3209cdc72356521354c5c8c14da">rreq_send</a> </td>
          <td>(</td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>dest_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>dest_seqno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int8_t&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="NA__aodv__rreq_8cc_source.html#l00173">173</a> of file <a class="el" href="NA__aodv__rreq_8cc_source.html">NA_aodv_rreq.cc</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="structRREQ.html">RREQ</a> *rreq;
    <span class="keyword">struct </span>in_addr dest;
    <span class="keywordtype">int</span> i;
    dest.s_addr = ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>));
    <span class="comment">/* Check if we should force the gratuitous flag... (-g option). */</span>
    <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a9114356a8b6ad57f39c4d50388776531">rreq_gratuitous</a>)
        flags |= <a class="code" href="NA__aodv__rreq_8h.html#a064b5e5007e297023c926e9c08a83fe6">RREQ_GRATUITOUS</a>;

    <span class="comment">/* Broadcast on all interfaces */</span>
<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>    <span class="keywordtype">double</span> delay = -1;
    <span class="keywordflow">if</span> (par(<span class="stringliteral">&quot;EqualDelay&quot;</span>))
        delay = par(<span class="stringliteral">&quot;broadcastDelay&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="NA__defs__aodv_8h.html#a995d79de9a32d682e10323e736e94505">MAX_NR_INTERFACES</a>; i++)
    {
        <span class="keywordflow">if</span> (!<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).enabled)
            <span class="keywordflow">continue</span>;
        rreq = <a class="code" href="NA__aodv__rreq_8cc.html#a37710bdd2be729c8112f74225c446a23" title="Route Request process hacked.">rreq_create</a>(flags, dest_addr, dest_seqno, <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).ipaddr);


<span class="preprocessor">#ifdef OMNETPP</span>
<span class="preprocessor"></span>        rreq-&gt;<a class="code" href="structAODV__msg.html#a14556cf0f421518fc2e073d4ba23ca25">ttl</a> = ttl;
        <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq, dest, <a class="code" href="NA__aodv__rreq_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>, 1, &amp;<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i),delay);
        totalRreqSend++;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rreq, dest, <a class="code" href="NA__aodv__rreq_8h.html#aeb57a50b78532df8cdc85169924c3a34">RREQ_SIZE</a>, 1, &amp;<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i));
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }
}
</pre></div>
</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="NA__aodv__rreq_8h.html">NA_aodv_rreq.h</a>      </li>

    <li class="footer">Generated on Fri Oct 18 2013 20:34:56 for NETWORK ATTACKS FRAMEWORK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
